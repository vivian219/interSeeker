<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Semantic UI</title>
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
	<script type="text/javascript" src="semantic/dist/semantic.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.semanticui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/list.css">
	<style type="text/css">
	</style>
</head>
<body>
<div class="ui inverted segment">
  <div class="ui inverted secondary menu">
  	<div class="item">
	   <img src="images/icon1.png">
	</div>
    <a class="item">
      Infor List
    </a>
    <a class="item">
      Manage
    </a>
    <a class="item">
      Contact
    </a>
    <div class="right menu">
	  <div class="item">
		<p style="font-family: '微软雅黑'; font-style: italic;">Administrator</p>
	  </div>
	  <a class="ui item" onclick="toggleLogin()">
	    Logout
	  </a>
	</div>
  </div>
</div>
<div class="ui container">
	<!-- <div class="ui grid"> -->
	<div class="ui hidden divider"></div>
	<table id="example" class="display ui celled table" cellspacing="0" width="100%">

        <thead>
            <tr>
                <th>序号</th>
                <th>情报标题</th>
                <th>发布日期</th>
                <th>情报来源</th>
                <th>状态</th>
                <th>TLP</th>
                <th>操作</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th>序号</th>
                <th>情报标题</th>
                <th>发布日期</th>
                <th>情报来源</th>
                <th>状态</th>
                <th>TLP</th>
                <th>操作</th>
            </tr>
        </tfoot>
    </table>
    <div class="ui longer modal">
      <i class="close icon"></i>
      <div class="header">
      DETAILS
      </div>
      <div class="scrolling content">
        <div class="description ui grid">
          <div class="ui form" onchange="detailModified()">
            <h3><i class="tags icon"></i><span>Cisco WebEx Meeting Center URL重定向漏洞</span></h3>
            <p>情报来源:　<span class="ui tiny icon transparent input">
                  <input type="text" spellcheck="false" value="绿盟">
                </span>
            发布日期:　<span>2017-11-30 18:00</span></br>
            MD5:　<span>u23t4u3247d4839c7832kjnc98c8cf3</span></br></p>
            <div class="ui divider"></div>
            <div>
                状态:　<div class="ui label inline-div">已更新</div>　　
                TLP:　　
                <div class="ui inline dropdown" id="TLPdropdown">
                  <div class="text ui red label" id="tlp">
                    不可共享
                  </div>
                  <i class="dropdown icon"></i>
                  <div class="menu">
                    <div class="item">不可共享
                    </div>
                    <div class="item">组织内共享
                    </div>
                    <div class="item">组织外限制共享
                    </div>
                    <div class="item">广泛共享
                    </div>
                  </div>
                </div>　
            </div>
            <div class="ui divider"></div>
            <div>文档标签:　<div class="inline-div" id="labellist">
                    <a class="ui label">公开<i class="delete icon" onclick="delLabel(this)"></i></a>
                    <a class="ui label">安全漏洞<i class="delete icon" onclick="delLabel(this)"></i></a>
                </div>
                <a class="ui gray label" onclick="addLabel()"><i class="plus icon"></i>添加</a>
                <div class="ui mini icon transparent input">
                  <input type="text" spellcheck="false" id="newlabel" placeholder="label...">
                </div>
            </div>
            <div class="ui divider"></div>
            <h5><i class="file text outline icon"></i>文档摘要</h5>
            <div class="field">
              <textarea spellcheck="false">服务端未对传入的跳转url变量进行检查和控制，可能导致可恶意构造任意一个恶意地址，诱导用户跳转到恶意网站。
由于是从可信的站点跳转出去的，用户会比较信任，所以跳转漏洞一般用于钓鱼攻击，通过转到恶意网站欺骗用户输入用户名和密码盗取用户信息，或欺骗用户进行金钱交易；
也可能引发的XSS漏洞（主要是跳转常常使用302跳转，即设置HTTP响应头，Locatioin: url，如果url包含了CRLF，则可能隔断了http响应头，使得后面部分落到了http body，从而导致xss漏洞）。</textarea>
            </div>

            <h5><i class="linkify icon"></i>文档URL</h5>
            <div class="ui link list" id="debug">
              <!-- <div class="item" id="url1">
                  <a><i class="minus circle icon" id="1" onclick="removeUrl(this)"></i></a>
                  <a href="https://semantic-ui.com/elements/list.html" target="_">https://semantic-ui.com/elements/list.html</a>
              </div>
              <div class="item" id="url2">
                  <a><i class="minus circle icon" id="2" onclick="removeUrl(this)"></i></a>
                  <a class="item" href="https://www.baidu.com/" target="_">https://www.baidu.com/</a>
              </div>
              <div class="item" id="url3">
                  <a><i class="minus circle icon" id="3" onclick="removeUrl(this)"></i></a>
                  <a class="item" href="https://www.threatminer.org/" target="_">https://www.threatminer.org/</a>
              </div> -->
              <div class="item inline fields" id="addurlbtn">
                  <a><i class="plus circle icon" onclick="addUrl()"></i></a>
                  <div class="ui mini eight wide field icon transparent input">
                    <input type="text" spellcheck="false" id="newurl" placeholder="new url...">
                  </div>
              </div>
            </div>
            

            <h5><i class="file text outline icon"></i>情报描述</h5>
            <div class="field">
              <textarea spellcheck="false">恶意用户完全可以借用URL跳转漏洞来欺骗安全意识低的用户，从而导致“中奖”之类的欺诈，这对于一些有在线业务的企业如淘宝等，危害较大，同时借助URL跳转，也可以突破常见的基于“白名单方式”的一些安全限制，如传统IM里对于URL的传播会进行安全校验，但是对于大公司的域名及URL将直接允许通过并且显示会可信的URL，而一旦该URL里包含一些跳转漏洞将可能导致安全限制被绕过。</textarea>
            </div>
            
            <h5><i class="spy icon"></i>相关Actors</h5>
            <table id="Actor-table" class="display ui celled table" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Start date</th>
                        <th>Salary</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Start date</th>
                        <th>Salary</th>
                    </tr>
                </tfoot>
            </table>
          </div>
        </div>
      </div>
      <div class="actions">
        <div class="ui green right pointing label" id="save-tip">

        </div>
        <div class="ui secondary disabled right labeled icon button" id="submit-change" onclick="detailSaved()">
          保存
          <i class="checkmark icon"></i>
        </div>
      </div>
    </div>

    <div class="login ui tiny modal">
    <div class="content">
        <div class="ui middle aligned center aligned grid">
          <div class="column">
            <h2 class="ui teal header">
              <div class="content">
                Log-in to your account
              </div>
            </h2>
            <form class="ui large form">
              <div class="ui segment">
                <div class="field">
                  <div class="ui left icon input">
                    <i class="user icon"></i>
                    <input type="text" name="email" spellcheck="false" placeholder="E-mail address">
                  </div>
                </div>
                <div class="field">
                  <div class="ui left icon input">
                    <i class="lock icon"></i>
                    <input type="password" name="password" placeholder="Password">
                  </div>
                </div>
                <div class="ui fluid large teal submit button">Login</div>
              </div>

              <div class="ui error message"></div>

            </form>

            <div class="ui message">
              New to us? <a href="#">Sign Up</a>
            </div>
          </div>
        </div>
    </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
    var table = $('#example').DataTable(
     {
        "processing": true,
        "aLengthMenu": [[10, 25, 50, -1], ["10条", "25条", "50条", "All"]],
        "serverSide": true,
        "ordering": false, // 禁止排序 
        "bAutoWidth": false,
        "ajax": {
            url: "http://localhost//test/api.php",
            type: 'POST'
        },
        // dt.Columns["column_name"].SetOrdianl(0);
        "aoColumnDefs":[
        {"aTargets":[0],sWidth:"8%"},
        // ,"mRender":function(data, type, full, meta){  
        //     return meta.row + 1 + meta.settings._iDisplayStart;  }
          // },
        {"aTargets":[1],sWidth:"25%"},
        {"aTargets":[2],sWidth:"12%"},
        {"aTargets":[3],sWidth:"12%",
        // "mRender":function(data,type,full){
        //              return "<a href=\"http://www.baidu.com/\" target=\"_\">"+data+"</a>    "}
                    },
        {"aTargets":[4],sWidth:"12%"},
        {"aTargets":[5],sWidth:"12%"},
        {"aTargets":[6],sWidth:"20%","className":"center aligned","mRender":function(data,type,full){
                      return "<div class=\"ui tiny button\" onclick=\"readOnlyDetails('"+full[0]+"');\" >详情</div>\
                      <div class=\"ui tiny button edit-btn\" >编辑</div>";}
                      
                    }]
    }
    );


    $("#example tbody").on("click",".edit-btn",function(){
           var tds=$(this).parents("tr").children();
           $.each(tds, function(i,val){
               var jqob=$(val);
               if(i < 1 || jqob.has('.button').length ){return true;}//跳过第1项 序号,按钮
               var txt=jqob.text();
               var put=$("<div class=\"ui transparent input full-width\"><input class=\"full-width\" type=\"text\" ></div>");
               put.children('input').val(txt);
               jqob.html(put);
           });
           $(this).html("保存");
           $(this).parents("tr").toggleClass("warning");
           $(this).toggleClass("edit-btn",false);
           $(this).toggleClass("save-btn",true);
    });


    $("#example tbody").on("click",".save-btn",function(){
           var row=table.row($(this).parents("tr"));
           var tds=$(this).parents("tr").children();
           $.each(tds, function(i,val){
               var jqob=$(val);

               //把input变为字符串
               if(!jqob.has('.button').length && i>0){
                   var txt=jqob.find("input").val();
                   jqob.html(txt);
                   table.cell(jqob).data(txt);//修改DataTables对象的数据
               }
           });
           var data=row.data();
           // $.ajax({
           //     "url":"/example/resources/user_share/inline_edit_no_plugin/edit.php",
           //     "data":data,
           //     "type":"post",
           //     "error":function(){
           //         alert("服务器未正常响应，请重试");
           //     },
           //     "success":function(response){
           //         alert(response);
           //     }
           // });
           alert(data);
           $(this).html("编辑");
           $(this).parents("tr").toggleClass("warning");
           $(this).toggleClass("edit-btn",true);
           $(this).toggleClass("save-btn",false);
    });
} );

function readOnlyDetails(data){
    $('#line-name').text(data);
    var table1 = $('#Actor-table').DataTable(
     {
        "destroy": true, // 允许重新加载
        "processing": true,
        "bFilter": false,    //去掉搜索框方法
        "paging": false,
        "bLengthChange": false,   //去掉每页显示多少条数据方法
        "serverSide": true,
        "ordering": false, // 禁止排序
        "ajax": {
            url: "http://localhost//test/api.php",
            type: 'POST'
        },
        "aoColumnDefs":[{"aTargets":[3],"mRender":function(data,type,full){
                     return "<a href=\"http://www.baidu.com/\" target=\"_\">"+data+"</a>    "}
                    }]
    }
    );

    $('#save-tip').hide();
    
    $('.longer.modal')
      .modal({closable: false})
      .modal('show')
    ;

    $('#TLPdropdown')
      .dropdown({
        onChange: function(val, text, choice) {
          tlpchange(val);
        }
      })
    ;

}
// open login modal
function toggleLogin() {
     $('.login.ui.tiny.modal')
      .modal('show')
    ;
}
// object for url number
var urls = {
  count : 0,
  add: function() {
    this.count += 1;
  },
  getValue: function() {
    return this.count;
  },
  remove: function() {
    if(this.count > 0){
      this.count -= 1;
    }
  }
}
// add link url
function addUrl() {
  // body...
  urls.add();
  var htmlcode = "<div class=\"item\" id=\"url"+urls.getValue()+"\"> \
                  <a><i class=\"minus circle icon\" id=\""+urls.getValue()+"\" onclick=\"removeUrl(this)\"></i></a>\
                  <a class=\"item\" href=\""+$('#newurl').val()+"\" target=\"_\">"+$('#newurl').val()+"</a>\
              </div>";
  var newitem = $(htmlcode);
  $('#addurlbtn').before(newitem);
  $('#newurl').val("");
  detailModified();
}

// remove link url
function removeUrl(item) {
  // body...
  urls.remove();
  $('#url'+item.id).remove();
  delete $('#url'+item.id);
  console.log($("#debug").children().length);
  console.log($('#url'+item.id));
  detailModified();
}

function detailModified() {
  $('#submit-change').toggleClass("disabled",false);
  $('#save-tip').hide();
}
function detailSaved() {
  $('#submit-change').toggleClass("disabled",true);
  $('#save-tip').text("数据修改成功！");
  $('#save-tip').show();
}

function addLabel() {
  $('#labellist').append("<a class=\"ui label\">"+$('#newlabel').val()+"<i class=\"delete icon\" onclick=\"delLabel(this)\"></i></a>");
  $('#newlabel').val("");
  detailModified();
}

function delLabel(obj) {
  $(obj).parent('a').remove();
  detailModified();
}

function tlpchange(val) {
  var obj = $('#tlp');
  switch(val){
    case "不可共享":
      obj.toggleClass("red",true);
      obj.toggleClass("orange",false);
      obj.toggleClass("green",false);
      obj.toggleClass("white",false); break;
    case "组织内共享":
      obj.toggleClass("red",false);
      obj.toggleClass("orange",true);
      obj.toggleClass("green",false);
      obj.toggleClass("white",false); break;
    case "组织外限制共享":
      obj.toggleClass("red",false);
      obj.toggleClass("orange",false);
      obj.toggleClass("green",true);
      obj.toggleClass("white",false); break;
    case "广泛共享":
      obj.toggleClass("red",false);
      obj.toggleClass("orange",false);
      obj.toggleClass("green",false);
      obj.toggleClass("white",true); break;
    
  }
}
</script>
</body>
</html>